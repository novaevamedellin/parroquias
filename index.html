<!DOCTYPE html>
<html lang="en">

<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, target-densityDpi=device-dpi, minimum-scale=1.0, maximum-scale = 1.0, user-scalable = no">
  <script src="NoSleep.min.js"></script>
  <script src="https://cdn.socket.io/4.5.0/socket.io.min.js" integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k" crossorigin="anonymous"></script>
	  
  <title>NovaEva Medellin</title>

  <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
  <script src="https://code.jquery.com/jquery-1.9.1.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.1/dist/leaflet.css"
    integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.1/dist/leaflet.js"
    integrity="sha256-NDI0K41gVbWqfkkaHj15IzU7PtMoelkzyKp8TOaFQ3s=" crossorigin=""></script>

  <style>
    html,
    body {
      height: 100%;
      margin: 0;
    }

    .leaflet-container {
      height: 400px;
      width: 600px;
      max-width: 100%;
      max-height: 100%;
    }
  </style>

  <style>
    body {
      padding: 0;
      margin: 0;
    }

    #map {
      height: 100%;
      width: 100vw;
    }
  </style>

</head>

<body>
  <div style="text-align: center;
  font-family: helvetica;
  color: white;
  background: black;
  padding: 11px;
  font-weight: bold;">Nueva Evangelización Medellín 2024</div>
  <div id="map"></div>
  <script>
    var greenIcon = L.icon({
     	iconUrl: 'https://wbsckt3.github.io/front_REPLIT-mapatag_ATLAS-wbskt2/icon.png'
    });
    const options = {
      enableHighAccuracy: true,
      maximumAge: 1000, // 1s
      timeout: 2000 // 2s
    }

    var parroquias = [
    {
      "nombre": "Santa Rita de Casia",
      "barrios": "Simon Bolivar",
      "inicia_dia": "Inician catequesis: 30-abr",
      "hora": "Martes y jueves 7:00 p. m.",
	  "latitude": "6.2451634364", 
	  "longitude" : "-75.60880404827"
    },
    {
      "nombre": "Ntra.Sra.de las Nieves",
      "barrios": "Manrique",
      "inicia_dia": "Inician catequesis: 20-may",
      "hora": "Lunes y miercoles 8:00 p. m.",
	  "latitude": "6.27387487968",
	  "longitude" : "-75.5493504940"
    },
    {
      "nombre": "El Inmaculado Corazon de Maria",
      "barrios": "Miramar",
      "inicia_dia": "Inician catequesis: 29-abr",
      "hora": "Lunes y martes 7:30 p. m.",
	  "latitude": "6.29302858184",
	  "longitude" : "-75.58306531674376"
    },
    {
      "nombre": "San Fernando Rey",
      "barrios": "Alfonso Lopez",
      "inicia_dia": "Inician catequesis: 22-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.2830294391", 
	  "longitude" : "-75.57593156361055"
    },
    {
      "nombre": "Santa Ines",
      "barrios": "Bello",
      "inicia_dia": "Inician catequesis: 8-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.334637813656",
	  "longitude" : "-75.555050905940"
    }, 
    {
      "nombre": "San Ignacio de Antioquia",
      "barrios": "El Trianon Envigado",
      "inicia_dia": "Inician catequesis: 8-abr",
      "hora": "Lunes y Jueves 8:00 p. m.",
	  "latitude": "6.159903015747", 
	  "longitude" : "-75.59394578447176"
    },
    {
      "nombre": "El Salvador",
      "barrios": "El Salvador",
      "inicia_dia": "Inician catequesis: 7-may",
	  "latitude": "6.23684387407",
	  "longitude" : "-75.56071701349485"
    },
    {
      "nombre": "Santa Maria de los Angeles",
      "barrios": "El Poblado",
      "inicia_dia": "Inician catequesis: 9-abr",
      "hora": "Martes y Jueves 8:00 p. m.",
	  "latitude": "6.19144507428",
	  "longitude" : "-75.579284260308"
    },
    {
      "nombre": "Jesus Nazareno",
      "barrios": "Belen Altavista",
      "inicia_dia": "Inician catequesis: 9-abr",
      "hora": "Martes y Jueves 7:30 p. m.",
	  "latitude": "6.230593287723",
	  "longitude" : "-75.62969811843469"
    },
    {
      "nombre": "Madre del Salvador",
      "barrios": "El Pedregal-Itagui",
	  "latitude": "6.19257007666",
	  "longitude" : "-75.61739008029502"
    },
    {
      "nombre": "San Juan Eudes",
      "barrios": "Itagui",
      "inicia_dia": "Inician catequesis: 7-may",
      "hora": "Martes y Jueves 8:00 p. m.",
	  "latitude": "6.16799992883",
	  "longitude" : "-75.62408985011649"
    },
    {
      "nombre": "Sta. Margarita Ma. de Alacoque",
      "barrios": "Robledo",
      "inicia_dia": "Inician catequesis: 9-abr",
      "hora": "Martes y Jueves 7:30 p. m.",
	  "latitude": "6.27580584911",
	  "longitude" : "-75.61608040594052"
    },
    {
      "nombre": "Santa Ana de la Quiebra",
      "barrios": "La Quiebra",
	  "latitude": "6.266768315519",
	  "longitude" : "-75.614698560838"
    },
    {
      "nombre": "San Felipe Neri",
      "barrios": "Robledo",
      "inicia_dia": "Inician catequesis: 5-may",
      "hora": "Martes y Jueves 8:00 p. m.",
	  "latitude": "6.28506465361",
	  "longitude" : "-75.5914228627443"
    },
    {
      "nombre": "Nuestra Señora del Encuentro",
      "barrios": "La Milagrosa",
      "inicia_dia": "Inician catequesis: 9-jul",
      "hora": "Martes y Jueves",
	  "latitude": "6.232808636731",
	  "longitude" : "-75.56225893474146"
    },
    {
      "nombre": "San Cristobal",
      "barrios": "San Cristobal",
	  "latitude": "6.2778569432932",
	  "longitude" : "-75.6353205669318"
    },
    {
      "nombre": "Maria Reina de los Angeles",
      "barrios": "La Candelaria",
      "inicia_dia": "Inician catequesis: 29-jul",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.25418319567",
	  "longitude" : "-75.55786406679296"
    },
    {
      "nombre": "San Juan de la Tasajera",
      "barrios": "Copacabana",
      "inicia_dia": "Inician catequesis: 16-abr",
      "hora": "Lunes y Jueves 8:00 p. m.",
	  "latitude": "6.35729264913",
	  "longitude" : "-75.495708671061"
    },
    {
      "nombre": "San Lorenzo de los Caunces",
      "barrios": "Buenos Aires",
      "inicia_dia": "Inician catequesis: 15-abr",
      "hora": "Lunes y Jueves 8:00 p. m.",
	  "latitude": "6.2309456338345",
	  "longitude" : "-75.53449506361085"
    },
    {
      "nombre": "San Luis Maria Grignon de Monfort",
      "barrios": "Manrique",
      "inicia_dia": "Inician catequesis: 29-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.274827905590",
	  "longitude" : "-75.54125650539117"
    },
    {
      "nombre": "Nuestra Señora del Jardin",
      "barrios": "Manrique",
      "inicia_dia": "Inician catequesis: 8-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.274854601995",
	  "longitude" : "-75.54714937140834"
    },
    {
      "nombre": "San Atanasio",
      "barrios": "La Iguana",
      "inicia_dia": "Inician catequesis: 16-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.2599413208115",
	  "longitude" : "-75.58086627895085"
    },
    {
      "nombre": "El Divino Nino",
      "barrios": "Villas del Sol-Bello",
      "inicia_dia": "Inician catequesis: 16-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.353415937798",
	  "longitude" : "-75.56812463477505"
    },
    {
      "nombre": "Santa Bernardita",
      "barrios": "Itagui",
      "inicia_dia": "Inician catequesis: 8-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.180399274578",
	  "longitude" : "-75.60530652565492"
    },
    {
      "nombre": "La Divina Misericordia",
      "barrios": "La Almeria",
      "inicia_dia": "Inician catequesis: 8-abr",
      "hora": "Lunes y jueves 8:00 p. m.",
	  "latitude": "6.246857024270",
	  "longitude" : "-75.61487880110768"
    },
    {
      "nombre": "Padre Pio de Pietralcina",
      "barrios": "Carambolas",
      "inicia_dia": "Inician catequesis: 5-may",
      "hora": "Martes y Domingo 8:00 p. m.",
	  "latitude": "6.2812608032527",
	  "longitude" : "-75.53857749525912"
    },
    {
      "nombre": "Sta. Catalina Laboure",
      "barrios": "El Congolo -Bello",
      "inicia_dia": "Inician catequesis: 8-abr",
      "hora": "Lunes y Jueves 7:30 p. m.",
	  "latitude": "6.339762547432",
	  "longitude" : "-75.55660231355868"
    },
    {
      "nombre": "Santa Maria del Carmen",
      "barrios": "Doce de Octubre",
      "inicia_dia": "Inician catequesis: 16-abr",
      "hora": "Martes y Jueves 7:30 p. m.",
	  "latitude": "6.303801920841",
	  "longitude" : "-75.57855800775"
    },
    {
      "nombre": "Pablo VI",
      "barrios": "Barrios de Jesus",
      "inicia_dia": "Inician catequesis: 9-abr",
      "hora": "Martes y Jueves 7:30 p. m.",
	  "latitude": "6.22970103437",
	  "longitude" : "-75.53448641931017"
    },
    {
      "nombre": "Maria Madre de los Huerfanos",
      "barrios": "Guayabal",
      "inicia_dia": "Mayo",
	  "latitude": "6.2023011126",
	  "longitude" : "-75.5830984212812"
    },
    {
      "nombre": "Maria Estrella Nueva Evangelización",
      "barrios": "La Estrella",
      "inicia_dia": "Inician catequesis: 5-feb",
      "hora": "Lunes y Jueves 8:00 p. m.",
	  "latitude": "6.1173004875554",
	  "longitude" : "-75.63300688262731"
    }
  ];

	  
    var map= "";
    var tiles ="";
    var marker, circle, markerCameras;
    const socket = io();	
     
     navigator.geolocation.watchPosition(({coords}) => {
         lat = coords.latitude
         lon = coords.longitude
         /*map = L.map('map').setView([lat, lon], 23);
	 tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 30, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
         }).addTo(map); */

	    fun(lat, lon)     
	     
         loadMarkers(parroquias);

         const timestamp = Date.now()
         if(localStorage.getItem('client') === null){ 
            localStorage.setItem('client', timestamp)
         } else {
            clientUniqueTimestampId =  localStorage.getItem('client')
            console.log(clientUniqueTimestampId)
         }         

         //Loop through the markers array
      /*   for (var i=0; i<markers.length; i++) {
			
			var lo = markers[i][1];
			var la = markers[i][2];
				var popupText = markers[i][0]; 
				var markerLocation = new L.LatLng(la, lo);
				var markerCameras = new L.Marker(markerLocation);
				map.addLayer(markerCameras);
			 
				markerCameras.bindPopup(popupText);
			
         } */ 
        
      
     }, console.error, options);
     
   /* var fun = function (la, lo) {
    	function onLocationFound(e) {
          var radius = e.accuracy / 2;
          if (marker) { // check
             map.removeLayer(marker); // remove
          }
          // marker = L.marker(e.latlng).addTo(map);
          marker = L.marker(e.latlng, {icon: greenIcon}).addTo(map);
	  marker.bindPopup("Tú estás aquí").openPopup(); // Agrega el popup
      	}
      map.on('locationfound', onLocationFound);
      map.locate({setView: false, watch: true, maxZoom: 23});    
    } */
 
var fun = function (la, lo) {
    var locationFound = false; // Variable para controlar si la ubicación actual ha sido encontrada

    function onLocationFound(e) {
        var radius = e.accuracy / 2;
        if (marker) { // check
            map.removeLayer(marker); // remove
        }
        // marker = L.marker(e.latlng).addTo(map);
        marker = L.marker(e.latlng, {icon: greenIcon}).addTo(map);
        marker.bindPopup("Tú estás aquí").openPopup(); // Agrega el popup
        locationFound = true; // Marca la ubicación como encontrada
        map.stopLocate(); // Detiene la búsqueda de ubicación después de encontrarla una vez
    }
    
    if (!map) { // Verifica si el mapa ya está inicializado
        map = L.map('map').setView([la, lo], 13);
        tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 30, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        map.on('locationfound', function(e) {
            if (!locationFound) { // Verifica si la ubicación aún no se ha encontrado
                onLocationFound(e); // Llama a la función onLocationFound solo si la ubicación aún no se ha encontrado
            }
        });
        map.locate({setView: false, watch: true, maxZoom: 13}); // No establezcas la vista aquí
    }
}
	  
   var loadMarkers = function(parroquias) {
   	parroquias.forEach(function(parroquia) {
	    L.marker([parseFloat(parroquia.latitude), parseFloat(parroquia.longitude)])
	      .addTo(map)
	      .bindPopup(`<b>${parroquia.nombre}</b><br>${parroquia.barrios}<br>${parroquia.inicia_dia}, ${parroquia.hora}`);
	});
   }

  </script>
</body>

</html>
